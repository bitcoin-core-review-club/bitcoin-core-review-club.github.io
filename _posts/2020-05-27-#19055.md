---
layout: pr
date: 2020-05-27
title: "Calculate UTXO set hash using Muhash"
pr: 19055
authors: [sipa, fjahr]
components: []
host: fjahr
status: upcoming
commit:
---

## Notes

- There is a bit of history to this PR:
  - Initially the idea of using Muhash in Bitcoin Core was introduced by Pieter Wuille in a [Mailing List post](https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2017-May/014337.html) and a PR [#10434](https://github.com/bitcoin/bitcoin/pull/10434) which still makes up most of the code in this PR
  - The author then picked up the proposal and made some further research in 2019, a snapshot of the work can be seen [in this gist](https://gist.github.com/fjahr/fa4892874b090d3a4f4fccc5bafa0210)
  - Based on some further insights and feedback the idea evolved into implementing an index for all coin statistics, not just the hash of the UTXO set, implemented in [#18000](https://github.com/bitcoin/bitcoin/pull/18000)
  - This PR is the first in a small series of PRs that implement #18000 incrementally
- The PR modifies how the hash of the UTXO set is calculated. That hash (as well as some other coin statistics) can be accessed through the RPC `gettxoutsetinfo`. It uses [the Muhash algorithm](https://cseweb.ucsd.edu/~mihir/papers/inchash.pdf) which allows for incremental hashing.
- The truncated hash [SHA512/256](https://eprint.iacr.org/2010/548.pdf) is used to prepare data for use in Muhash.

## Questions

- What does incremental hashing mean? What are the properties that we are looking for to make it useful for our use case?
- What were the use cases for `gettxoutsetinfo` described in the resource links? Can you think of others? Which ones are the most relevant to you?
- What is the biggest downside to introduce Muhash for the UTXO set hash in your mind?
- This PR does not only add Muhash but also `TruncatedSHA256Writer`. Why do we need it?
- Why is the Muhash class implemented in Bitcoin Core and not in lib secp256k1?
- Did you look into the other proposed hashing algorithms in some of the resources? What were their drawbacks? Do you think Muhash is the right choice?
- What are your thoughts on the benchmarks for Muhash? Meaning both the benchmarking code and what were your observations if you tested the code locally?
- Considering the trade-offs, should the old hashing algorithm be kept around and accessible using a flag for example?

<!-- TODO: uncomment and add meeting log
## Meeting Log

{% irc %}
{% endirc %}
--->
